# FICTION: Future Information extraCTION

This project contains the means to generate new facts and their
descriptions.

1. Unseen future facts can be generated with TLogic and the
   `fiction/gen_new_facts.py` script.
2. Descriptions can then be added to these facts with the
   `fiction/gen_description.py` script.
   
   
# Usage

## Dependencies Installation

The project manages dependencies with [uv](https://github.com/astral-sh/uv). You can install dependencies and setup an environment with `uv sync`.

Alternatively, you can use pip:

```sh
python -m venv .venv
source .venv/bin/activate
pip install -r requirements
```

## Generating Future Facts

### The Easy Way

If you are in the right environment, simply running `make output/yago2026-facts.txt` should do everything to generate facts. Basically, this commands follows the following steps:

1. Download the Yago4.5 database
2. Strip it down to a smaller version (see `strip_yago.py`)
3. Extract a dataset from it in the format expected by TLogic (see `yago2dataset.py`)
4. Train the TLogic module by extracting rules
5. Generate new facts using these rules 

You can also filter 2022 facts from yago using `make output/yago2022-facts.txt`

### Details 

The `fiction/gen_new_facts.py` script can be used to generate new facts using TLogic. To do that, it needs:

- A starting YAGO 4.5 knowledge base
- TLogic rules, obtained by training TLogic on YAGO 4.5

To obtain the YAGO knowledge base, you can download the original directly from the [YAGO website](https://yago-knowledge.org/downloads/yago-4-5). However, this version weighs 142GB! This is an issue of storage, as well as a problem when loading the database into RAM. Therefore, we provide the following script to create a stripped-down version of YAGO (GNU Grep is needed for the script to work):

```sh
python strip_yago.py --input-dir yago4.5_full --output-dir yago4.5
```

After downloading, it is necessary to transform the knowledge base into a format understood by TLogic. This can be done with the `yago2dataset.py` script:

```sh
python yago2dataset.py\
       --input-dir ./yago4.5\
       --output-dir ./data/yago4.5\
       --linearize\
       --sparsity-filter-threshold 1\
       --min-year 1950\
       --max-year 2024\
       --relations\
       schema:memberOf schema:worksFor schema:award yago:academicDegree yago:replaces yago:playsIn\
       schema:location schema:spouse schema:sponsor schema:nationality schema:homeLocation\
       schema:manufacturer yago:ownedBy yago:leader yago:participant schema:contentLocation\
       schema:owns yago:notableWork yago:neighbors yago:capital yago:terminus yago:beliefSystem\
       schema:founder yago:doctoralAdvisor schema:actor yago:sportNumber schema:locationCreated\
       schema:performer schema:musicBy yago:director yago:appearsIn schema:publisher\
       yago:conferredBy yago:candidateIn schema:editor schema:superEvent schema:director\
       schema:inLanguage schema:lyricist schema:organizer schema:material\
       schema:productionCompany yago:studentOf schema:children yago:follows schema:knowsLanguage\
       yago:influencedBy schema:gender schema:recordLabel yago:flowsInto yago:officialLanguage\
       yago:lowestPoint\
       --start-only-relations schema:children schema:founder schema:locationCreated yago:follows\
       yago:influencedBy schema:knowsLanguage schema:lyricist
```

Using that dataset, we can train TLogic rules:

```sh
python -m fiction.tlogic.learn\
       --dataset yago4.5\
       --rule_lengths 1 2 3\
       --num_walks 200\
       --seed 12\
       --num_processes 1
```

Finally, we can generate new facts for 2026:

```sh
python -m fiction.gen_new_facts\
       --rules ./output/yago4.5/r1,2,3_n200_exp_s12_rules.json\
       --rule-lengths 1 2 3\
       --dataset-dir ./data/yago4.5\
       --yago-dir ./yago4.5\
       --year 2026\
       --mimic-year 2022\
       --process-nb 8\
       --non-exclusive-relations startAward startNotableWork startNeighbors startFounder startDoctoralAdvisor startPerformer startMusicBy startAppearsIn startConferredBy startCandidateIn\
       --output-file "./output/yago2026-facts.txt"
```

To obtain 2022 facts, the script `fiction/filter_facts.py` can be used to filter existing facts from YAGO:

```sh
python -m fiction.filter_facts\
       --dataset-dir ./data/yago4.5\
       --output-file ./output/yago2022-facts.txt\
       --min-year 2022\
       --max-year 2022
```


## Generating Descriptions

The `fiction/gen_description.py` script can generate either single-fact descriptions or multi-facts descriptions. In the single-fact setup, it takes as input a file with the facts generated by TLogic and a language model, and outputs a json file with quadruples and their descriptions. The language model can either be specified as an HuggingFace checkpoint prefixed with `hf:`, or as a vertex AI model prefixed by `vertexai:`. See `--help` for details. Example usage:

```sh
python -m fiction.gen_description\
       --facts-file "./output/yago2026-facts.txt"\
       --language-model "hf:meta-llama/Meta-Llama-3.1-8B-Instruct"\
       --output-file "./output/yago2026.json"
```

In the multi-facts setup, we have to pass additional arguments. `--multi-min-size` and `--multi-max-size` specify the minimum and maximum size of fact groups. `--multi-yago-dir` specifies the YAGO directory, which is needed to grouping facts by computing the distance between them. `--multi-alpha` and `--multi-k` are parameters in that distance computation, see the article for more details on these parameters. Example usage:

```sh
python -m fiction.gen_description\
       --facts-file "./output/yago2026-facts.txt"\
       --language-model "hf:meta-llama/Meta-Llama-3.1-8B-Instruct"\
       --multi-min-size 2\
       --multi-max-size 4\
       --multi-yago-dir "./yago4.5"\
       --multi-alpha 0.9\
       --multi-k 0.03\
       --output-file "./output/yago2026_multi.json"
```

You can use also use the Makefile to generate facts using a default configuration (uses `"hf:meta-llama/Meta-Llama-3.1-8B-Instruct"` by default):

- `make output/yago2026.json`
- `make output/yago2026_multi.json`
- `make output/yago2022.json`
- `make output/yago2022_multi.json`
